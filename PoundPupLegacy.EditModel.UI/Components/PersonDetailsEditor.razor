@inherits EditorDetailBase
<InterPersonalRelationsEditor 
    RelationsFrom="PersonDetails.InterPersonalRelationsFrom.ToList()" 
    RelationsTo="PersonDetails.InterPersonalRelationsTo.ToList()" 
    RelationTypes="PersonDetails.InterPersonalRelationTypes" 
    PersonItem="Person"/>
<PersonPoliticalEntityRelationsEditor 
    PartyTypeName="person"
    Person="Person"
    Relations="PersonDetails.PersonPoliticalEntityRelations.ToList()"
    RelationTypes="PersonDetails.PersonPoliticalEntityRelationTypes" />
<PersonOrganizationRelationsEditorForPerson 
    Person="Person"
    Relations="PersonDetails.PersonOrganizationRelations.ToList()"
    RelationTypes="PersonDetails.PersonOrganizationRelationTypes" />

@code {
    [Parameter]
    [EditorRequired]
    public PersonDetails PersonDetails { get; set; } = default!;

    public override async Task<List<ErrorDetail>> Validate()
    {
        return await Task.FromResult(new List<ErrorDetail>());
    }

    public override void OnTitleChange(string title)
    {
        foreach (var relation in PersonDetails.PersonPoliticalEntityRelations.OfType<PersonOrganizationRelation.ForPerson.Complete.Resolved.ToUpdate>()) {
            relation.Person.Name = title;
        };
        foreach (var relation in PersonDetails.PersonOrganizationRelations.OfType<PersonOrganizationRelation.ForPerson.Complete.Resolved.ToCreate>()) {
            relation.Person.Name = title;
        };
        StateHasChanged();
    }

    private PersonItem? Person => PersonDetails switch {
        PersonDetails.ForUpdate n => new PersonListItem {
                Id = NodeId!.Value,
                Name = PersonDetails.Name
            },
        PersonDetails.ForCreate nn => new PersonName {
            Name = PersonDetails.Name
        },
        _ => null
    };
}
