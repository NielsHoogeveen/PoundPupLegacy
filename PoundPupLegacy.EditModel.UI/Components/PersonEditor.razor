@inherits EditorBase
<InterPersonalRelationsEditor 
    Relations="Model.InterPersonalRelations" 
    RelationTypes="Model.InterPersonalRelationTypes" 
    PersonId="Model.NodeId"/>
<PartyPoliticalEntityRelationsEditor 
    PartyTypeName="person"
    Party="Person"
    Relations="Model.PartyPoliticalEntityRelations"
    RelationTypes="Model.PartyPoliticalEntityRelationTypes" />
<PersonOrganizationRelationsEditor 
    IsPersonLeading = "true"
    LeadingParty="Person"
    Relations="Model.PersonOrganizationRelations"
    RelationTypes="Model.PersonOrganizationRelationTypes" />

@code {
    [Parameter]
    [EditorRequired]
    public Person Model { get; set; } = default!;

    public override async Task Validate(ValidationMessageStore validationMessageStore, List<string> invalidIds)
    {
        await Task.CompletedTask;
    }

    public override void OnTitleChange(string title)
    {
        foreach (var relation in Model.PartyPoliticalEntityRelations) {
            relation.Party.Name = title;
        };
        foreach (var relation in Model.PersonOrganizationRelations) {
            relation.Person!.Name = title;
        };
        foreach (var relation in Model.InterPersonalRelations) {
            if (relation.PersonFrom is not null) {
                if (relation.PersonFrom.Id.HasValue) {
                    if (relation.PersonFrom.Id == Model.NodeId) {
                        relation.PersonFrom.Name = title;
                    }
                }
                else {
                    relation.PersonFrom.Name = title;
                }
            }
            if (relation.PersonTo is not null) {
                if (relation.PersonTo.Id.HasValue) {
                    if (relation.PersonTo.Id == Model.NodeId) {
                        relation.PersonTo.Name = title;
                    }
                }
                else {
                    relation.PersonTo.Name = title;
                }
            }
        };

        StateHasChanged();
    }

    private PersonListItem Person => new PersonListItem {
        Id = Model.NodeId,
        Name = Model.Title
    };
}
