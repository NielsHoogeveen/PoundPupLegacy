@using PoundPupLegacy.Services
@inject ISiteDataService SiteDataService
@inject NotFoundListener NotFoundListener;
@code {

    protected bool CanAccessPage { get; set; } = false;

    [CascadingParameter(Name = "User")]
    public User User { get; set; } = default!;

    [CascadingParameter(Name = "TenantId")]
    public ITenant Tenant { get; set; } = default!;

    protected sealed override void OnInitialized()
    {
        base.OnInitialized();
    }
    protected sealed override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        var routeAttribute = this.GetType().GetCustomAttributes(true).OfType<Microsoft.AspNetCore.Components.RouteAttribute>().FirstOrDefault()?.Template;
        if(routeAttribute is not null) {
            CanAccessPage = await SiteDataService.HasAccess(
                userId: User.Id,
                path: routeAttribute);
        }
        if (!CanAccessPage) {
            NotFoundListener.NotifyNotFound();            
        }
    }
}
