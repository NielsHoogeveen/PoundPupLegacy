@using PoundPupLegacy.Services
@inherits ViewerBase
@inject ISiteDataService SiteDataService
@inject NotFoundListener NotFoundListener;
@code {

    protected bool CanAccessPage { get; set; } = false;

    protected sealed override void OnInitialized()
    {
        base.OnInitialized();
    }
    protected virtual async Task OnAfterInitializedAsync()
    {
        await Task.CompletedTask;
    }
    protected sealed override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        var routeAttribute = this.GetType().GetCustomAttributes(true).OfType<Microsoft.AspNetCore.Components.RouteAttribute>().FirstOrDefault()?.Template;
        if(routeAttribute is not null) {
            CanAccessPage = await SiteDataService.HasAccess(
                userId: User.Id,
                path: routeAttribute);
        }
        if (!CanAccessPage) {
            NotFoundListener.NotifyNotFound();            
        }
        await OnAfterInitializedAsync();
    }
}
