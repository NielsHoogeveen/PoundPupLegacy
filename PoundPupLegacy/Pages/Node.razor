@page "/node/{Id:int}"
@using PoundPupLegacy.ViewModel.Models
@using PoundPupLegacy.Components
@using PoundPupLegacy.Services
@inherits Page
@inject IFetchNodeService NodeDataService

@if (CanAccessPage)
{
    @if (_node is not null)
    {
        <CascadingValue Value="@Id" Name="NodeId">
            <CascadingValue Value="@_node.UrlId" Name="UrlId">
                @if (UserId == 0)
                {
                    <NodeViewerNotSignedIn Model="@_node" />
                }
                else
                {
                    <NodeViewerSignedIn Model="@_node" />
                }
            </CascadingValue>
        </CascadingValue>
    }
}
else {
    <NoAccess />
}

@code {
    [Parameter]
    public int Id { get; set; }

    private ViewModel.Models.Node? _node;

    protected override async Task OnInitializedPageAsync()
    {
        _node = await NodeDataService.FetchNode(Id, UserId, TenantId);
    }
}
