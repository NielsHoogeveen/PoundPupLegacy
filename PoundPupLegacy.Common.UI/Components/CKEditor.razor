@inherits InputTextArea
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager

<textarea @attributes="AdditionalAttributes"
          id="@Id"
          class="@CssClass"
          value="@CurrentValue"></textarea>
<style>
    :root{
        --ck-color-focus-border: var(--editor-border-color);
    }    
    .ck.ck-editor {
        border-radius: 5px;
        border: solid 2px var(--editor-border-color);
        box-shadow: var(--input-shadow);
        margin-bottom: 1em;
    }

    .ck.ck-editor__main > .ck-editor__editable:not(.ck-focused){
        border-color: var(--editor-border-color);
    }
</style>
@code {

    [Parameter]
    [EditorRequired]
    public string? Id { get; set; }

    public string? UrlToPostImage => $"{NavigationManager.BaseUri}image/upload";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
            await JSRuntime.InvokeVoidAsync("CKEditorInterop.init", Id, UrlToPostImage, DotNetObjectReference.Create(this));

        await base.OnAfterRenderAsync(firstRender);
    }

    [JSInvokable]
    public Task EditorDataChanged(string data)
    {
        CurrentValue = data;
        StateHasChanged();
        return Task.CompletedTask;
    }

    protected override void Dispose(bool disposing)
    {
        JSRuntime.InvokeVoidAsync("CKEditorInterop.destroy", Id);
        base.Dispose(disposing);
    }
}